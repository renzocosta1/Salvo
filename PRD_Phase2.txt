<context>
# Overview  
Salvo Alpha: Turnout Engine for Maryland 2026 Primary (June 23, 2026). This is NOT a social network. This is a behavioral engineering tool to ensure 100% participation through peer accountability and tactical missions. Built on top of the working MVP (auth, onboarding, offline sync), this Alpha adds: Voter Registration Card verification, address-to-district assignment, contact sync for relational recruitment, pre-loaded tactical missions, digital ballot with endorsed candidates, Polymarket integration for live odds, and weekly notification pulse. Primary target: Montgomery County + MD-6 Congressional District. Core loop: Onboarding ‚Üí Verification ‚Üí Relational Recruitment ‚Üí Verified Vote. Success metric: 100% verified turnout on Election Day.

# Core Features  
**The "Geographic Lock"**: Onboarding includes address entry screen. Mapbox Geocoding API converts address ‚Üí lat/lng ‚Üí Maryland County + Legislative District + Congressional District. Users auto-assigned to correct district. This determines their ballot, their Squad/District peers, and their notification scope. Database stores full Maryland geography: All 47 Legislative Districts, all 23 Counties, all Congressional Districts. Initial focus: Montgomery County + MD-6.

**The "War Room" HUD (Tab 1)**: Replaces generic Command Feed. Shows three elements: (1) **The Oracle**: Polymarket API integration displays live win-probabilities for MD-6 Congressional and Montgomery County Executive races. Updates every 15 minutes. (2) **The Pulse**: Weekly Saturday notification at 11:00 AM triggers 2-second "Oath Renewal" animation to prevent iOS app offloading. (3) **The Timers**: High-impact countdowns to Registration Deadline (June 2, 2026), Early Voting Start (June 11), and Election Day (June 23).

**The "Relational Raid" (Tab 2: Invite)**: Contact sync matches phone contacts against Maryland Voter DB. Display tactical status for each contact: Green icon (In Salvo + Verified), Yellow icon (Registered Republican, not in app), Gray icon (Not registered). Users earn XP for every contact who joins AND verifies their Voter Registration Card. This creates peer pressure and accountability loops.

**The "Tactical Mission" Set (Tab 3: Commands)**: Four pre-loaded missions hardcoded in database. NO dynamic mission creation UI for Alpha. Missions: (1) **Enlistment**: Upload Voter Registration Card (Gemini 1.5 Flash verifies + client-side redaction), (2) **Mail-in Strike**: Proof of mail-in ballot request/submission (screenshot or photo), (3) **Early Raid** (June 11-18): GPS check-in at Early Voting center + photo proof, (4) **Election Day Siege** (June 23): Deep-link to Google Maps for precinct waypoint + "I Voted" sticker photo. Within Squad/District, display who has "Confirmed Ballot" vs. who is AWOL. Public accountability.

**The Digital Ballot "End Game"**: "Ballot" tab displays replica of user's FULL down-ballot for their district. Includes: Governor, U.S. Senate, U.S. House (MD-6), State Senate, State House, County Executive, County Council, DA, School Board, Court Judges, Ballot Questions/Amendments. Endorsed candidates (hard_party_endorsed = true) highlighted in **Neon Green**. Feels like "voting for your team." Users commit to vote for each endorsed candidate. Completionist badge awarded only if user verifies voting for ALL endorsed seats on Election Day.

**Notification as Primary Weapon**: Weekly Saturday 11 AM notification (Oath Renewal). Election countdown reminders (T-14 days, T-7 days, T-1 day, Election Day morning). Squad/District alerts when peers complete missions. Polymarket odds shifts >5% trigger urgent notifications. Mission verification results. Goal: Keep notifications ON year-round by making them critical intel, not spam.

# User Experience  
**User Personas**: 
- **Warrior (Voter)**: Age 18-65, Maryland resident, registered Republican. Wants to ensure "their team wins" the Primary. Completes 4 tactical missions, recruits contacts, keeps notifications on. Needs clear instructions and peer accountability. Public Callsign in app, real name stored securely (encrypted).
- **Captain (Squad Leader)**: Manually assigned by leadership in database (no UI for Alpha). Monitors their Squad/District stats. Can see who has "Confirmed Ballot" vs. AWOL. Rank cap at "Captain" - Officer promotion requires in-person interview.
- **Leadership (Admin)**: Manual database access. Pre-loads 4 missions. Manually inserts ballots with endorsed candidates. Assigns Captains via SQL. No fancy admin UI for Alpha - speed over polish.

**Key User Flows**:
1. **New User Onboarding**: Sign up ‚Üí Oath screen ‚Üí Personal details (age/gender) ‚Üí **Address entry (NEW)** ‚Üí Mapbox geocoding ‚Üí Auto-assigned to County/District ‚Üí Feature preferences ‚Üí **Enlistment Mission prompt** (Upload Voter Registration Card) ‚Üí Main app
2. **Enlistment (Verification)**: User sees "URGENT: Complete Enlistment" ‚Üí Taps mission ‚Üí Camera opens ‚Üí User photographs Voter Registration Card ‚Üí **Client-side redaction** of sensitive fields (Voter ID#, full address) ‚Üí Upload to Gemini 1.5 Flash ‚Üí AI verifies: (a) Document is MD Voter Registration Card, (b) Name matches profile, (c) Party = Republican ‚Üí If verified: "VERIFIED" badge, unlock full app. If rejected: "Appeal to Captain" option.
3. **Relational Raid (Contact Sync)**: User taps Invite tab ‚Üí App requests Contacts permission ‚Üí Syncs phone contacts ‚Üí Backend matches contacts against MD Voter DB (by phone number if available, else manual search) ‚Üí Display list with icons: Green (In Salvo), Yellow (Registered Rep, not in app), Gray (Not registered) ‚Üí User taps contact ‚Üí Share invite link via SMS ‚Üí If contact joins + verifies: +100 XP "Recruiter" badge progress.
4. **War Room Check-In**: User opens app ‚Üí War Room HUD shows: (1) **Oracle**: "MD-6: 52% Hard Party | MoCo Exec: 48% Hard Party" (Polymarket live odds), (2) **Timers**: "Election Day: 47 days 12 hours", (3) **Pulse**: Saturday 11 AM notification: "Renew your Oath" ‚Üí User taps ‚Üí 2-second animation ‚Üí XP awarded ‚Üí iOS doesn't offload app.
5. **Early Voting Raid (June 11-18)**: User receives notification "Early Voting starts TODAY" ‚Üí Opens Commands tab ‚Üí Taps "Early Raid" mission ‚Üí App deep-links to Google Maps with nearest Early Voting center ‚Üí User votes early ‚Üí Returns to app ‚Üí Camera opens ‚Üí Photo of "I Voted" sticker or polling place ‚Üí Gemini verifies photo shows voting proof ‚Üí Mission complete ‚Üí Squad/District leaderboard updates ‚Üí Public accountability: "John Smith completed Early Raid ‚úÖ"
6. **Election Day Siege (June 23)**: User receives 6 AM notification "ELECTION DAY: Vote for Hard Party!" ‚Üí Opens Ballot tab ‚Üí Sees full down-ballot with Neon Green endorsed candidates ‚Üí Memorizes selections ‚Üí Goes to precinct ‚Üí Votes ‚Üí Returns to app ‚Üí Uploads "I Voted" sticker photo ‚Üí App prompts: "Did you vote for ALL Neon Green candidates?" ‚Üí User confirms ‚Üí Completionist Badge + 500 XP ‚Üí Squad stats update: "15/20 CONFIRMED BALLOTS"

**UI/UX Considerations**:
- **Citizen-style Dark Theme**: Already implemented. Maintain consistency across all new screens.
- **Mission Creation Must Be Dead Simple**: Dropdown, dynamic fields, one-click create. No room for Captain error.
- **Ballot Guide Must Feel Like Real Ballot**: Mirror actual ballot design. Neon Green highlights make endorsements obvious. "Vote for our team" framing.
- **Notifications Must Feel Valuable**: Short, urgent, action-oriented. "New mission in your district" not "Hey check out the app!"
- **One-Tap Actions**: Open link, upload proof, verify mission. Minimize friction at every step.
</context>

<PRD>
# Technical Architecture  

**Database Schema Additions** (Build on existing schema):

```sql
-- Add geographic fields to profiles table (The "Geographic Lock")
ALTER TABLE profiles ADD COLUMN address_line1 TEXT;
ALTER TABLE profiles ADD COLUMN address_line2 TEXT;
ALTER TABLE profiles ADD COLUMN city TEXT;
ALTER TABLE profiles ADD COLUMN state TEXT DEFAULT 'Maryland';
ALTER TABLE profiles ADD COLUMN zip_code TEXT;
ALTER TABLE profiles ADD COLUMN county TEXT; -- e.g., "Montgomery"
ALTER TABLE profiles ADD COLUMN legislative_district TEXT; -- e.g., "District 15"
ALTER TABLE profiles ADD COLUMN congressional_district TEXT; -- e.g., "MD-6"
ALTER TABLE profiles ADD COLUMN latitude NUMERIC;
ALTER TABLE profiles ADD COLUMN longitude NUMERIC;
ALTER TABLE profiles ADD COLUMN geocoded_at TIMESTAMPTZ;

-- Add verification tracking to profiles
ALTER TABLE profiles ADD COLUMN voter_registration_verified BOOLEAN DEFAULT FALSE;
ALTER TABLE profiles ADD COLUMN voter_registration_verified_at TIMESTAMPTZ;
ALTER TABLE profiles ADD COLUMN voter_registration_photo_url TEXT; -- Encrypted URL
ALTER TABLE profiles ADD COLUMN real_name_encrypted TEXT; -- For leadership's secure "Hire" list
ALTER TABLE profiles ADD COLUMN callsign TEXT; -- Public display name

-- Simplify role system (no complex leadership hierarchy for Alpha)
-- Keep existing: 'general', 'captain', 'warrior'
-- Captain manually assigned via SQL, rank cap at Captain for Alpha

-- Maryland Ballot System (The "End Game")
CREATE TABLE md_ballots (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  election_date DATE NOT NULL DEFAULT '2026-06-23', -- Maryland Primary
  county TEXT NOT NULL,
  legislative_district TEXT NOT NULL,
  congressional_district TEXT NOT NULL,
  election_name TEXT NOT NULL DEFAULT '2026 Maryland Republican Primary',
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(county, legislative_district, congressional_district)
);

CREATE TABLE md_ballot_races (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  ballot_id UUID NOT NULL REFERENCES md_ballots(id) ON DELETE CASCADE,
  race_title TEXT NOT NULL, -- e.g., "Governor", "U.S. Senate", "MD-6 U.S. House", "State Senate District 15", "County Executive", "DA", "School Board At-Large", "Circuit Court Judge", "Question 1"
  race_type TEXT NOT NULL CHECK (race_type IN ('federal', 'state', 'county', 'local', 'judicial', 'ballot_question')),
  position_order INT NOT NULL, -- Order on ballot (top to bottom)
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE md_ballot_candidates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  race_id UUID NOT NULL REFERENCES md_ballot_races(id) ON DELETE CASCADE,
  candidate_name TEXT NOT NULL,
  candidate_party TEXT DEFAULT 'Republican',
  hard_party_endorsed BOOLEAN NOT NULL DEFAULT FALSE, -- TRUE = Neon Green highlight
  candidate_order INT NOT NULL, -- Order within race
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- User ballot commitments (track who committed to vote for endorsed candidates)
CREATE TABLE user_ballot_commitments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  race_id UUID NOT NULL REFERENCES md_ballot_races(id) ON DELETE CASCADE,
  candidate_id UUID NOT NULL REFERENCES md_ballot_candidates(id) ON DELETE CASCADE,
  committed_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id, race_id)
);

-- Election Day verification (The "Judgment")
CREATE TABLE election_day_verifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  verified_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  verification_photo_url TEXT NOT NULL, -- "I Voted" sticker or polling place photo
  voted_all_endorsed BOOLEAN NOT NULL DEFAULT FALSE, -- Completionist badge check
  UNIQUE(user_id)
);

-- Pre-loaded Tactical Missions (hardcoded, no dynamic creation)
-- Mission 1: ENLISTMENT (Upload Voter Registration Card)
-- Mission 2: MAIL_IN_STRIKE (Proof of mail-in ballot request)
-- Mission 3: EARLY_RAID (GPS check-in + photo at Early Voting center, June 11-18)
-- Mission 4: ELECTION_DAY_SIEGE (Google Maps waypoint + "I Voted" sticker, June 23)

ALTER TABLE directives ADD COLUMN mission_type TEXT CHECK (mission_type IN (
  'ENLISTMENT', 'MAIL_IN_STRIKE', 'EARLY_RAID', 'ELECTION_DAY_SIEGE'
));
ALTER TABLE directives ADD COLUMN mission_deadline DATE; -- e.g., June 2 (registration), June 11 (early voting start), June 23 (election day)
ALTER TABLE directives ADD COLUMN requires_gps BOOLEAN DEFAULT FALSE; -- TRUE for Early Raid
ALTER TABLE directives ADD COLUMN google_maps_link TEXT; -- For Election Day Siege waypoint

-- Contact Sync for Relational Raid
CREATE TABLE synced_contacts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  contact_phone TEXT NOT NULL,
  contact_name TEXT,
  voter_status TEXT CHECK (voter_status IN ('in_salvo', 'registered_not_in_app', 'not_registered')),
  invited_at TIMESTAMPTZ,
  joined_at TIMESTAMPTZ,
  verified_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id, contact_phone)
);
```

**API Integrations**:
- **Mapbox Geocoding API**: Already have token (`EXPO_PUBLIC_MAPBOX_ACCESS_TOKEN`). Use Geocoding API endpoint: `https://api.mapbox.com/geocoding/v5/mapbox.places/{address}.json?access_token=...`. Returns lat/lng. Then map to Maryland County + Legislative District + Congressional District using lookup table.
- **Google Gemini 1.5 Flash**: Already integrated via Edge Function. Use for: (1) Voter Registration Card verification (detect document type, verify name match, check party = Republican), (2) "I Voted" sticker verification, (3) Early Voting photo verification. **Critical**: Implement client-side redaction BEFORE upload to blur sensitive fields (Voter ID#, full address).
- **Polymarket Gamma API**: Integrate to fetch live win-probabilities for MD-6 Congressional and Montgomery County Executive races. Poll every 15 minutes. Display in War Room HUD. Trigger urgent notification if odds shift >5% in 24 hours.
- **Maryland Voter DB**: For contact sync, need to match phone contacts against registered voter list. Options: (1) Use Maryland State Board of Elections API (if available), (2) Manual CSV import of public voter file, (3) Simplified Alpha: User manually searches contacts by name in app, app shows if they're in Salvo.

**Geographic Lookup System**:
- Create `maryland_districts.json` with County ‚Üí Legislative District ‚Üí Congressional District mapping
- All 47 Legislative Districts, all 23 Counties, all 8 Congressional Districts
- Simple lookup: Given lat/lng from Mapbox, determine County, then Legislative District, then Congressional District
- Fallback: If geocoding fails, manual County/District dropdown selector
- For Alpha: Hardcode Montgomery County districts (14-20) and MD-6, expand later

**Voter Registration Card Verification Flow**:
1. User taps "Enlistment" mission ‚Üí Camera opens
2. User photographs MD Voter Registration Card
3. **Client-side redaction** (React Native Image Manipulator): Blur Voter ID# and full address before upload
4. Upload redacted image to Supabase Storage (encrypted)
5. Edge Function calls Gemini 1.5 Flash API with prompt: "Is this a Maryland Voter Registration Card? Extract: Name, Party, County. Verify Party = Republican."
6. Gemini returns: {isValid: true, name: "John Smith", party: "Republican", county: "Montgomery"}
7. Backend checks: name matches profile.display_name (fuzzy match)
8. If verified: Set profile.voter_registration_verified = TRUE, unlock full app
9. If rejected: "Verification failed. Appeal to your Captain."

**Pre-loaded Mission Logic** (No dynamic creation for Alpha):
```sql
-- Manually insert 4 missions via SQL:
INSERT INTO directives (party_id, title, body, mission_type, mission_deadline, target_goal, xp_reward) VALUES
  ('hard-party-id', 'Enlistment', 'Upload your MD Voter Registration Card to verify your identity.', 'ENLISTMENT', '2026-06-02', 10000, 100),
  ('hard-party-id', 'Mail-in Strike', 'Request or submit your mail-in ballot. Upload proof (screenshot or photo).', 'MAIL_IN_STRIKE', '2026-06-18', 3000, 150),
  ('hard-party-id', 'Early Raid', 'Vote early June 11-18. Check in at your Early Voting center and upload proof.', 'EARLY_RAID', '2026-06-18', 5000, 200),
  ('hard-party-id', 'Election Day Siege', 'Vote on June 23. Use Google Maps to find your precinct. Upload "I Voted" sticker.', 'ELECTION_DAY_SIEGE', '2026-06-23', 10000, 500);
```

**Deep Link System** (Replace MapBox entirely):
- For Election Day Siege mission: Generate Google Maps deep link to user's precinct
- Use Expo Linking: `Linking.openURL(`https://www.google.com/maps/dir/?api=1&destination=${precinct_lat},${precinct_lng}`)`
- No custom map UI needed - leverage native Google Maps app

# Development Roadmap (Simplified for Alpha)

**Phase 1: Database Foundation & Geographic Lock** (Critical Path)
- Run migration SQL to add: address fields, voter verification fields, MD ballot tables, contact sync table
- Create `maryland_districts.json` lookup file: All 47 Legislative Districts mapped to 23 Counties and 8 Congressional Districts
- Initial focus: Montgomery County (Districts 14-20) + MD-6, but full Maryland data ready for expansion
- Add address entry screen to onboarding flow (after personal-details, before feature-selection)
- Integrate Mapbox Geocoding API: Address form ‚Üí API call ‚Üí lat/lng ‚Üí Maryland district lookup
- Auto-assign user to County, Legislative District, Congressional District
- Store in `profiles` table: county, legislative_district, congressional_district, lat, lng
- Fallback UI: If geocoding fails, manual County/District dropdown selector
- Manually insert 4 pre-loaded missions via SQL (Enlistment, Mail-in Strike, Early Raid, Election Day Siege)

**Phase 2: Voter Registration Card Verification** (Critical Path - The Gate)
- Build "Enlistment" mission screen (camera upload + redaction)
- Implement client-side image redaction using `expo-image-manipulator`: Blur Voter ID# and full address
- Upload redacted image to Supabase Storage (encrypted bucket)
- Create Supabase Edge Function: `verify-voter-registration`
- Edge Function calls Gemini 1.5 Flash API with prompt: "Is this a Maryland Voter Registration Card? Extract: Name, Party, County."
- Backend validates: (a) Party = Republican, (b) Name fuzzy matches profile.display_name, (c) County matches address geocoding
- If verified: Set `profiles.voter_registration_verified = TRUE`, unlock full app
- If rejected: Show "Verification failed. Contact your Captain to appeal."
- Display "VERIFIED" badge on profile once complete

**Phase 3: War Room HUD (Tab 1 Redesign)** (High Impact)
- Replace generic Command Feed with War Room HUD
- **The Oracle**: Integrate Polymarket Gamma API to fetch live odds for MD-6 and MoCo Executive races
- Poll Polymarket API every 15 minutes, cache results in Supabase
- Display odds as progress bars or gauge charts: "MD-6: 52% Hard Party | MoCo Exec: 48% Hard Party"
- **The Timers**: Create countdown components for: Registration Deadline (June 2, 2026), Early Voting (June 11), Election Day (June 23)
- Display days/hours/minutes remaining in large tactical font
- **The Pulse**: Implement weekly Saturday 11 AM notification with 2-second "Oath Renewal" animation
- Animation: Fade in Hard Party logo ‚Üí User taps to confirm ‚Üí +10 XP ‚Üí Prevents iOS app offloading

**Phase 4: Relational Raid (Tab 2: Contact Sync)** (Peer Accountability)
- Request Contacts permission after onboarding (same flow as existing invite tab)
- Sync phone contacts using `expo-contacts`
- Store contacts in `synced_contacts` table with phone numbers
- **Option A (Full DB)**: Match contacts against Maryland Voter DB (if API available)
- **Option B (Simplified Alpha)**: Allow user to manually search contacts by name, app shows if they're already in Salvo
- Display status icons: Green (In Salvo + Verified), Yellow (In Salvo, not verified), Gray (Not in app)
- "Invite" button sends SMS with invite code
- Track in `invites` table: When contact joins, when they verify
- Award +100 XP per contact who joins AND completes Enlistment mission

**Phase 5: Pre-loaded Tactical Missions (Tab 3)** (Hardcoded)
- Update Commands tab to show 4 pre-loaded missions (no dynamic creation UI)
- Mission 1 (ENLISTMENT): Upload Voter Registration Card ‚Üí Gemini verification (already built in Phase 2)
- Mission 2 (MAIL_IN_STRIKE): Upload screenshot or photo of mail-in ballot request/submission ‚Üí Gemini verification
- Mission 3 (EARLY_RAID): GPS check-in at Early Voting center (June 11-18) + photo proof ‚Üí Gemini verification
- Mission 4 (ELECTION_DAY_SIEGE): Deep-link to Google Maps for precinct waypoint + "I Voted" sticker photo ‚Üí Gemini verification
- Display "Squad Status" section: List users in same District showing who completed each mission (public accountability)
- Use existing directive/salvo system, just add new mission types to enum

**Phase 6: Digital Ballot "End Game"** (High Impact)
- Create "Ballot" tab (new route)
- Fetch user's ballot from `md_ballots` ‚Üí `md_ballot_races` ‚Üí `md_ballot_candidates` based on user's County/District
- Build ballot UI: Replica of real ballot with race titles in order
- Highlight endorsed candidates (hard_party_endorsed = TRUE) in **Neon Green**
- Show all down-ballot races: Governor, U.S. Senate, U.S. House, State Senate, State House, County Executive, County Council, DA, School Board, Circuit Court Judges, Ballot Questions
- "Commit to Vote" button per race ‚Üí Insert into `user_ballot_commitments`
- Track completionist progress: X/Y races committed
- On Election Day: Upload "I Voted" sticker ‚Üí Prompt: "Did you vote for ALL Neon Green candidates?" ‚Üí If yes: Completionist Badge + 500 XP

**Phase 7: Manual Ballot Seeding** (Admin/Leadership)
- NO fancy ballot management UI for Alpha
- Leadership manually inserts ballots via SQL or simple admin script
- Create SQL script: `seed_montgomery_county_ballot.sql`
- Script inserts: (1) md_ballots row for Montgomery County + MD-6, (2) md_ballot_races for each race, (3) md_ballot_candidates with hard_party_endorsed flags
- Verify ballot matches official Maryland sample ballot
- Expand to other counties by duplicating script

**Phase 8: Weekly Notification Pulse** (Retention Weapon)
- Implement Saturday 11 AM weekly notification using `expo-notifications` (or defer if push not ready)
- Notification title: "Renew Your Oath"
- Notification body: "Tap to confirm your commitment to the Hard Party"
- When tapped: Open app ‚Üí Show 2-second animation (Hard Party logo fade-in) ‚Üí Award +10 XP
- Purpose: Keep app active in iOS memory, prevent offloading, maintain weekly engagement
- Track in `user_preferences`: last_pulse_at, pulse_streak_count

**Phase 9: Google Maps Deep Linking** (Replace MapBox)
- Remove all MapBox custom map UI (map.tsx tab)
- For Election Day Siege mission: Generate Google Maps deep link
- Lookup user's precinct based on address (use precinct lookup table or Mapbox forward geocoding)
- Deep link format: `https://www.google.com/maps/dir/?api=1&destination={precinct_lat},{precinct_lng}`
- Use `Linking.openURL()` to open in native Google Maps app
- No custom map rendering needed - leverage native maps

**Phase 10: Testing & Alpha Launch** (Production Readiness)
- End-to-end testing: Onboarding ‚Üí Address entry ‚Üí Enlistment ‚Üí Contact sync ‚Üí War Room ‚Üí Ballot
- Test with real Maryland addresses (Montgomery County focus)
- Manually create 3-5 test Captains via SQL
- Verify Gemini verification for: Voter Registration Cards, "I Voted" stickers, Early Voting photos
- Test Polymarket API integration (ensure odds update every 15 minutes)
- Performance testing: 1,000 concurrent users
- Beta testing: 50-100 real Montgomery County users
- Launch countdown: 120 days before June 23, 2026 Primary (March 2026 launch target)

# Logical Dependency Chain (Simplified for Alpha)

**Phase 1 (Database & Geographic Lock) is Foundation**: Must come first. Cannot verify users without address data. Cannot show correct ballot without district assignment. Blocks everything else.

**Phase 2 (Voter Verification) is The Gate**: Must come after Phase 1 (need address for county validation). This is the critical anti-cheat mechanism. Users cannot access full app until verified. Blocks Phases 3-6.

**Phase 3 (War Room HUD) Can Be Parallel**: Independent feature. Can be built alongside Phase 2. Only dependency: Polymarket API integration. Provides immediate "wow" factor for testers.

**Phase 4 (Relational Raid) Depends on Phase 2**: Cannot award XP for recruited contacts until Enlistment verification is working. Requires Phase 2 complete.

**Phase 5 (Pre-loaded Missions) Depends on Phase 2**: Mission 1 (Enlistment) IS Phase 2. Missions 2-4 (Mail-in, Early Raid, Election Day) use same Gemini verification pattern. Sequential build.

**Phase 6 (Digital Ballot) Depends on Phase 1**: Requires district assignment from Phase 1. Can be built in parallel with Phases 2-5. Ballot display doesn't require verification.

**Phase 7 (Manual Ballot Seeding) Can Start Early**: Leadership can write SQL scripts while app is being built. No code dependencies. Just data entry.

**Phase 8 (Weekly Pulse Notification) is Optional for Alpha**: Nice-to-have. Can be deferred if push notifications not ready. App works without it.

**Phase 9 (Google Maps Deep Linking) is Simple**: No dependencies. Just URL generation and Linking.openURL(). Can be built anytime.

**Phase 10 (Testing) is Continuous**: Test each phase as it's built. Don't wait until end.

**Critical Path for Alpha Launch**: 
Phase 1 (Database) ‚Üí Phase 2 (Voter Verification) ‚Üí Phase 5 (Pre-loaded Missions) ‚Üí Phase 6 (Digital Ballot) ‚Üí Phase 10 (Testing)

**Parallel Work**:
- Phase 3 (War Room) can be built while Phase 2 is in progress
- Phase 4 (Relational Raid) can be built while Phase 5 is in progress
- Phase 7 (Ballot Seeding) can happen anytime
- Phase 9 (Google Maps) can happen anytime

**Quick Wins for Leadership Demo**:
- Phase 1 complete ‚Üí Show "Users auto-assigned to districts based on address"
- Phase 2 complete ‚Üí Show "AI verification of Voter Registration Cards"
- Phase 3 complete ‚Üí Show "Live Polymarket odds in War Room"
- Phase 6 complete ‚Üí Show "Digital ballot with Neon Green endorsed candidates"

# Risks and Mitigations (Alpha Focus)

**Risk: Voter Registration Card Verification False Positives/Negatives**
- Mitigation: Use Gemini 1.5 Flash with strict prompts. Test with real MD Voter Registration Cards. Manual Captain review fallback for disputed verifications. Allow users to appeal rejected proofs. Client-side redaction prevents PII leaks. Accuracy target: >95%.

**Risk: District Data Accuracy for Maryland**
- Mitigation: Start with Montgomery County only (6 districts). Simple JSON lookup table. Fallback to manual district selection if geocoding fails. Test with 50+ real Montgomery County addresses before launch. Verify County/District assignments manually.

**Risk: Address Privacy Concerns**
- Mitigation: Clear privacy policy during address entry. Explain it's only for district assignment. Do not share full addresses with other users or leadership. Store lat/lng rounded to 3 decimal places. Client-side redaction for Voter Registration Cards. All PII encrypted at rest.

**Risk: Polymarket API Rate Limits or Downtime**
- Mitigation: Poll API every 15 minutes (not every second). Cache results in Supabase. If API fails, display last cached odds with "Last updated: X minutes ago" timestamp. Graceful degradation: War Room still works without live odds.

**Risk: Contact Sync Permission Denial**
- Mitigation: Make contact sync optional (not required to use app). Explain benefit: "Find friends who are registered Republicans and recruit them." If user denies, skip to next step. Can enable later in settings.

**Risk: Election Day Reliability**
- Mitigation: App must work perfectly June 23, 2026. Offline queue system already exists. Extensive load testing before launch (simulate 5,000+ concurrent users). Database backups. Disaster recovery plan. Monitor Supabase performance. Fallback: Manual verification if Gemini API fails.

**Risk: Ballot Endorsement Accuracy**
- Mitigation: Leadership manually creates ballots via SQL script. Double-check candidate names and races against official MD sample ballot. Test with Montgomery County sample ballot first. Legal review of endorsement language. Preview ballot in app before publishing to users.

**Risk: Timeline Too Aggressive for June 2026 Primary**
- Mitigation: Simplified Alpha scope (10 phases vs. 20+ in original PRD). No dynamic mission creation UI. No complex leadership hierarchy. No multi-state expansion. Focus 100% on Montgomery County + MD-6. Launch target: March 2026 (120 days before Primary = 4 months for recruitment/testing).

**Risk: User Drop-Off After Verification**
- Mitigation: Make Enlistment mission feel like an achievement, not a chore. Award +100 XP + "VERIFIED" badge immediately. Unlock War Room HUD to show Polymarket odds (instant dopamine hit). Prompt to invite contacts right after verification (peer pressure loop).

**Risk: No Captains to Monitor Squad Status**
- Mitigation: For Alpha, manually assign 5-10 trusted Captains via SQL. Captain role is mostly observational (view Squad stats). No complex management UI needed. Captain can manually approve disputed verifications. Post-Alpha: Build Captain recruitment flow.

**Risk: Gemini API Costs Exceed Budget**
- Mitigation: Gemini 1.5 Flash is cheap ($0.075 per 1M input tokens). Estimate: 10,000 users √ó 4 photo verifications = 40,000 API calls. Even at $0.10 per call = $4,000 total for entire Primary cycle. Budget $10,000 for safety. If costs spike, add rate limiting (1 verification attempt per 5 minutes).

# Appendix (Alpha Reference)

**Pre-loaded Mission XP Values** (Hardcoded, no customization):
```
ENLISTMENT: 100 XP (verification: Gemini 1.5 Flash checks MD Voter Registration Card)
MAIL_IN_STRIKE: 150 XP (verification: Gemini checks screenshot/photo of mail-in ballot request)
EARLY_RAID: 200 XP (verification: GPS check-in + Gemini checks Early Voting photo)
ELECTION_DAY_SIEGE: 500 XP (verification: Gemini checks "I Voted" sticker photo)
RECRUITER_BONUS: 100 XP per contact (verification: Contact joins + completes Enlistment)
COMPLETIONIST_BADGE: 500 XP (verification: User confirms voting for ALL Neon Green candidates)
```

**Verification Method by Mission Type**:
```
ENLISTMENT:
  - User uploads photo of MD Voter Registration Card
  - Client-side redaction: Blur Voter ID# and full address
  - Gemini prompt: "Is this a Maryland Voter Registration Card? Extract: Name, Party, County."
  - Backend validates: Party = Republican, Name fuzzy matches profile, County matches address

MAIL_IN_STRIKE:
  - User uploads screenshot or photo of mail-in ballot request confirmation
  - Gemini prompt: "Does this show proof of a mail-in ballot request or submission?"
  - Backend validates: Image shows official Maryland election website or mail-in ballot

EARLY_RAID (June 11-18, 2026):
  - User GPS check-in at Early Voting center (compare lat/lng to known Early Voting locations)
  - User uploads photo of polling place or "I Voted" sticker
  - Gemini prompt: "Does this photo show an Early Voting location or proof of voting?"
  - Backend validates: GPS within 100m of Early Voting center + photo verified

ELECTION_DAY_SIEGE (June 23, 2026):
  - App generates Google Maps deep link to user's assigned precinct
  - User votes, returns to app, uploads "I Voted" sticker photo
  - Gemini prompt: "Does this photo show an 'I Voted' sticker or polling place?"
  - Backend validates: Photo shows voting proof
  - Bonus prompt: "Did you vote for ALL Neon Green candidates?" ‚Üí If yes: Completionist Badge
```

**Simplified Role Structure** (No complex leadership hierarchy for Alpha):
```
General (Admin)
  ‚Üì manually assigns via SQL
Captain (Squad Leader)
  ‚Üì monitors
Warrior (Voter)

General: Has full database access, manually inserts ballots, assigns Captains
Captain: Views Squad/District stats, can manually approve disputed verifications
Warrior: Completes missions, recruits contacts, votes for endorsed candidates
```

**Maryland Legislative Districts** (Full state data ready, Montgomery County priority):
```
Montgomery County (Alpha Launch Target):
- District 14 (Germantown, Clarksburg) - MD-6
- District 15 (Gaithersburg, Kentlands) - MD-6
- District 16 (Olney, Brookeville) - MD-6
- District 17 (Potomac, Bethesda) - MD-6
- District 18 (Chevy Chase, Kensington) - MD-6/MD-8
- District 19 (Silver Spring, Montgomery Hills) - MD-8
- District 20 (Takoma Park, Langley Park) - MD-8

Alpha Focus: Montgomery County Districts 14-17 (MD-6 Congressional District)
Post-Alpha Expansion: Districts 18-20, then other MD counties

maryland_districts.json structure:
{
  "Montgomery": {
    "District 14": { "congressional": "MD-6", "county": "Montgomery" },
    "District 15": { "congressional": "MD-6", "county": "Montgomery" },
    ...
  },
  "Baltimore": { ... },
  ...
}
```

**Ballot Example Structure** (Montgomery County District 15, MD-6, June 23, 2026 Republican Primary):
```
Race 1: Governor (race_type: state, position_order: 1)
  - Dan Cox (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - Larry Hogan (hard_party_endorsed: FALSE)

Race 2: U.S. Senate (race_type: federal, position_order: 2)
  - Chris Chaffee (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 3: U.S. House MD-6 (race_type: federal, position_order: 3)
  - Neil Parrott (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 4: State Senate District 15 (race_type: state, position_order: 4)
  - [Endorsed candidate] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 5: State House District 15 (race_type: state, position_order: 5)
  - [Endorsed candidates] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 6: Montgomery County Executive (race_type: county, position_order: 6)
  - [Endorsed candidate] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 7: County Council At-Large (race_type: county, position_order: 7)
  - [Endorsed candidates] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 8: District Attorney (race_type: local, position_order: 8)
  - [Endorsed candidate] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 9: Board of Education (race_type: local, position_order: 9)
  - [Endorsed candidates] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 10: Circuit Court Judge (race_type: judicial, position_order: 10)
  - [Endorsed candidates] (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - [Other candidates] (hard_party_endorsed: FALSE)

Race 11: Question 1: School Bond (race_type: ballot_question, position_order: 11)
  - YES (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
  - NO (hard_party_endorsed: FALSE)

Race 12: Question 2: Tax Cap (race_type: ballot_question, position_order: 12)
  - YES (hard_party_endorsed: FALSE)
  - NO (hard_party_endorsed: TRUE) ‚Üê Neon Green highlight
```

Note: Candidate names are placeholders. Leadership will manually insert real candidate names from official MD Primary ballot.

**Notification Strategy Examples** (Alpha Focus):
```
‚úÖ GOOD: "Renew Your Oath" (Saturday 11 AM weekly pulse)
‚úÖ GOOD: "Early Voting starts in 3 days! Complete your Early Raid mission."
‚úÖ GOOD: "ELECTION DAY: Polls close in 2 hours. Vote for ALL Neon Green candidates!"
‚úÖ GOOD: "Your friend John Smith just verified! You earned +100 XP."
‚úÖ GOOD: "Voter Registration Card verified! +100 XP. Unlock War Room."
‚úÖ GOOD: "5 members of District 15 completed Election Day Siege. Don't be AWOL!"

‚ùå BAD: "Check out the app today!"
‚ùå BAD: "Daily reminder to vote"
‚ùå BAD: "Thanks for using Salvo"
‚ùå BAD: "We have updates"
```

**Alpha Launch Timeline** (Maryland June 23, 2026 Primary):
```
March 2026 (T-120 days): Alpha Launch
  - Montgomery County Districts 14-17 (MD-6)
  - Target: 1,000 verified users
  - 5-10 manually assigned Captains

April 2026 (T-90 days): Recruitment Phase
  - Contact sync drives invites
  - Target: 5,000 verified users
  - Weekly Saturday pulse notifications keep engagement high

May 2026 (T-60 days): Mission Phase
  - Mail-in Strike mission opens (request mail-in ballots)
  - Target: 50% of users request mail-in ballots

June 2, 2026 (T-21 days): Registration Deadline
  - Enlistment mission closes (all users must be verified by now)
  - Target: 10,000 verified users

June 11-18, 2026 (T-12 to T-5 days): Early Voting Phase
  - Early Raid mission active (GPS + photo verification)
  - Target: 30% of users complete Early Raid

June 23, 2026 (T-0 day): ELECTION DAY
  - Election Day Siege mission (Google Maps waypoint + "I Voted" sticker)
  - Target: 100% turnout (all verified users vote)
  - Completionist Badge for users who vote for ALL Neon Green candidates

Post-Primary: Expand to other MD counties, prepare for General Election (November 2026)
```

**Technical Stack Summary** (Alpha Additions):
```
ALREADY BUILT (MVP):
‚úÖ Expo + React Native + Expo Router
‚úÖ Supabase PostgreSQL, Auth, Realtime, Storage
‚úÖ Mapbox (will use for geocoding only, remove map UI)
‚úÖ H3 hexagons (will be deprecated, replaced with Google Maps deep links)
‚úÖ Gemini 1.5 Flash Edge Function (extend for voter card verification)
‚úÖ expo-sqlite offline queue
‚úÖ Citizen-style dark theme UI
‚úÖ Onboarding flow (oath, personal details, feature selection)

NEW FOR ALPHA:
üÜï Mapbox Geocoding API (address ‚Üí County + District)
üÜï maryland_districts.json (district lookup table)
üÜï expo-image-manipulator (client-side redaction)
üÜï expo-contacts (contact sync for Relational Raid)
üÜï expo-linking (Google Maps deep links)
üÜï Polymarket Gamma API (live odds for War Room HUD)
üÜï MD ballot tables (md_ballots, md_ballot_races, md_ballot_candidates)
üÜï Contact sync table (synced_contacts)
üÜï Voter verification tracking (profiles.voter_registration_verified)
üÜï Weekly Saturday notification (Oath Renewal pulse)

REMOVED FROM ALPHA:
‚ùå MapBox custom map UI (replace with Google Maps deep links)
‚ùå H3 hexagon check-ins (replace with GPS + Google Maps)
‚ùå Dynamic mission creation UI (hardcode 4 missions instead)
‚ùå Leadership assignment UI (manual SQL instead)
‚ùå Multi-state expansion (Maryland only)
‚ùå Plum Book feature
‚ùå ID upload (use Voter Registration Card instead)
```
</PRD>
